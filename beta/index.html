<!doctype html>
<html>
	<head>
		<meta charset="utf-8"/>
		<meta http-equiv="X-UA-Compatible" content="chrome=1"/>
		<title>Quantum Physics Simulator by mailmindlin</title>
		<!--Meta tags -->
		<meta name="description" content="A simulator for the quantum properties of theoretical molecules."/>
		<meta name="robots" content="INDEX, noimageindex"/><!--no image index is just for copyright stuff-->
		<meta name="revisit-after" content="2 days"/><!--because of constant updates-->
		<meta name="author" content="mailmindlin, jschrier"/>
		<!-- github's css -->
		<link rel="stylesheet" href="../stylesheets/styles.css" onerror="loadError('Github\'s styles.css')"/>
		<link rel="stylesheet" href="../stylesheets/pygment_trac.css" onerror="loadError('Github\'s pygment_trac.css')"/>
		<!-- my css -->
		<link rel="stylesheet" href="main.css" onerror="loadError('main.css')"/>
		<link rel="stylesheet" href="animations.css" onerror="loadError('animations.css')"/>
		<link rel="stylesheet" href="cursor-props.css" onerror="loadError('cursor-props.css')"/>
		<!-- jquery -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" class="imp-scr1" onerror="loadError('jquery 1.7.1')"></script>
		<script src="../javascripts/respond.js" class="imp-scr2" onerror="loadError('Github\'s respond.js')"></script>
		<!-- JSMol -->
		<script type="text/javascript" src="../jsmol/jsmol/JSmol.min.js" onerror="loadError('JSmol.js')"></script>
		<!-- my scripts -->
		<script type="text/javascript" onerror="loadError('Main loader')">//<![CDATA[
			//cross-compatibility
			//indexedDB stuff
			window.indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;
			window.IDBTransaction = window.IDBTransaction || window.webkitIDBTransaction || window.msIDBTransaction;
			window.IDBKeyRange = window.IDBKeyRange || window.webkitIDBKeyRange || window.msIDBKeyRange;
			
			//set whether this is a production build. Production builds have some features enabled/disabled
			window['Production'] = false;
			
			//setup std. objects
			window.debug=false;
			window.isWebkit = 'WebkitAppearance' in document.documentElement.style;
			window['Module'] = function(name, script, dependencies, funcName) {
			 	var module		= Object.create(null);
			 	module.name		= name;
			 	module.script		= script;
			 	module.dependencies	= dependencies;
			 	module.funcName		= funcName;
			 	module.isComplete	= false;
			 	module.run = function() {
			 		window[funcName]();
			 		module.isComplete=true;
			 		window['ModuleController'].onModuleCompletion();
			 	};
			 	return module;
			 };
			 window['ModuleController'] = (function() {
			 	var self = Object.create(null);
			 	self.canStart = false;
			 	self.modules = [];
			 	self.availableModules = [];
			 	self.promises= [];
			 	self.registerModule = function(module) {
			 		self.modules.push(module);
			 	};
			 	self.onScriptLoad = function(scriptName) {
			 		for(var i=0;i<modules.length;++i) {
			 			var cModule = modules[i];
			 			if(cModule.script = scriptName) {
			 				//check validity
			 				var requisites = cModule.dependencies;
			 				for(var i=0;i<requisites.length;++i){
			 					var tModule = self.getModule(requisite[i]);
			 					if(tModule.isComplete)requisites.splice(i,1);//remove from array
			 				}
			 				if(requisites.length==0)cModule.run();
			 			}
			 		}
			 	};
			 	self.getModule = function(name) {
			 		for(var i = 0; i<modules.length;++i) {
			 			if(modules[i].name == name)return modules[i];
			 		}
			 	};
			 	self.start = function() {
			 		self.canStart = true;
			 		for(var module in self.availableModules) {
			 			window.setTimeout(module.run(),0);//run module asynchronously
			 		};
			 	};
			 	self.isModuleLoaded = function(name) {
			 		return self.getModule(name).isComplete;
			 	};
			 	self.checkPrerequisites = function(prereqs) {
			 		for(var requisite in prereqs) {
			 			if(!self.isModuleLoaded(requisite)) return false;
			 		}
			 		return true;
			 	};
			 	self.promiseScriptLoad = function(scripts, fn) {
			 		var obj = Object.create(null);
			 		obj.req = scripts;
			 		obj.fn = fn;
			 		self.promises.push(obj);
			 		self.updatePromises();
			 		return self;
			 	};
			 	self.updatePromises = function() {
			 		for(var i=0;i<self.promises.length;i++) {
			 			if(self.checkPrerequisites(self.promises[i].req)) {
			 				setTimeout(self.promises[i].fn, 0);//run fn async
			 				self.promises.splice(i,1);
			 			}
			 		}
			 	};
			 	self.onModuleCompletion = function() {
			 		self.updatePromises;
			 	};
			 })();
			 window['TSStorage'] = function(args) {
			 	var self = Object.create(null);
			 	self.put = function(name, url, data) {
			 		var scrObj = Object.create(null);
			 		scrObj.name	= name;
			 		scrObj.url	= url;
			 		// scrObj.version	= version;
			 		scrObj.data	= data;
			 		window.localStorage.setItem("SCRIPTSTORE-" + name, JSON.stringify(scrObj));
			 	};
			 	self.has = function(name) {
			 		return (window.localStorage.getItem("SCRIPTSTORE-" + name) !== null);
			 	};
			 	self.get = function(name, version) {
			 		return JSON.parse(window.localStorage.getItem("SCRIPTSTORE-" + name)).data;
			 	};
			 	self.setup = function() {
			 		return self;
			 	};
			 	return self.setup();
			 };
			/**
			 * Loader object.
			 * Basically handles scripts that load or fail to load, and smooths it out.
			 */
			window['Loader'] = (function() {
				var self = Object.create(null);
				//vardef
				self.hasErrors=false;
				self.failureQueue = {};
				self.successQueue = {};
				self.waitingQueue = {};
				self.tsStorage    = new TSStorage();
				self.scriptCache  = [];
				self.scriptDependencies = {
					"utils.js":[],
					"session.js":[],
					"renderer.js":["utils.js"],
					"renderUtils.js":["renderer.js"],
					"networking.js":["utils.js"],
					"jsmol.js":["utils.js"],
					"input.js":["utils.js", "logger.js"],
					"help.js":["logger.js", "utils.js"],
					"console.js":[],
					"communications.js":[] };
				//functiondef
				self.onSuccess = function(src, name) {
					var obj = Object.create(null);
					obj.src = src;
					obj.name = name;
					self.successQueue[name] = obj;
					delete self.waitingQueue[name];
					delete self.waitingQueue[name];
					console.log("%cLoaded " + name + " from " + src,'color:green;');
				};
				self.onFail = function(src, name) {
					self.hasErrors=true;
					var obj = Object.create(null);
					obj.src = src;
					obj.name = name;
					self.failureQueue = obj;
					if((typeof self.waitingQueue[name] !== 'undefined')/* && (self.waitingQueue[name].cachable)*/)self.createScript(name, self.getFromCache(name, self.waitingQueue[name].url,0,true));
					delete self.waitingQueue[name];
					//TODO remove object from the waitingQueue
					console.log("%cFailed to load " + name + " from " + src,'color:red;');
				};
				self.createScript = function(name, data) {
					var sct = document.createElement("script");
					sct.setAttribute("name",name);
					sct.innerHTML=data;
					sct.setAttribute("type","text/javascript");
					var headTag = document.querySelector("head");
					headTag.appendChild(sct);
				};
				self.getFromCache = function(name, url, tryAJAX, canCreateScript, tryTSS) {
					if(typeof tryAJAX === 'undefined')tryAJAX=true;
					if (typeof version === "undefined")version = "LATEST";
					if(typeof tryTSS === 'undefined')tryTSS=true;
					if(typeof canCreateScript === 'undefined')canCreateScript=false;
					if(self.tsStorage.has(name) && (window['Production'] == true) && canCreateScript && tryTSS) {//only read from cache if it's production, TSS is allowed (TSStorage), and it can create a script (because why load it from the cache if it cant do anything with it).
						if(canCreateScript)self.createScript(name, self.tsStorage.get(name));
					} else if (tryAJAX) {
						console.log("Getting " + name + " from " + url + " via AJAX");
						self.getFromAjax(name, url, false, function(response, wasGood) {
							if(!wasGood) {
								console.error("AJAX to " + name + "Failed!");
								self.failureQueue.push({name:name});
								return;
							}
							self.tsStorage.put(name, url, response.target.responseText);
							if(canCreateScript)self.createScript(name, response.target.responseText);
							self.progress.progressValue=self.objLength(self.successQueue);
							if(self.objLength(self.waitingQueue)==0) {
								if(self.objLength(self.failureQueue.length)==0) {
									self.progress.progressHidden=true;
								}else{
									self.progress.progressLabel="Please Reload!";
								}
							}
						});
					}
				};
				self.getFromAjax = function(name, url, directlyAdd, callback) {//callback is optional
					var selfFn = Object.create(null);
					selfFn.name = name;
					selfFn.url = url;
					selfFn.directlyAdd = directlyAdd;
					if (window.XMLHttpRequest) {
						selfFn.xmlhttp=new XMLHttpRequest();// code for IE7+, Firefox, Chrome, Opera, Safari
					} else {
						selfFn.xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");// code for IE6, IE5
					}
					if(selfFn.xmlhttp == null) throw(new Error("XMLHTTP not supported!"));
					selfFn.xmlhttp.onload = function(ev) {
						self.tsStorage.put(selfFn.name, selfFn.url, selfFn.xmlhttp.responseText);
						console.log(["XMLHTTP Success",selfFn,ev]);
						if(typeof callback === 'function')callback(ev, true);
					};
					selfFn.xmlhttp.onerror = function(e) {
						console.log(e);
						console.log(["XMLHTTP Failure",selfFn,e]);
						callback(e, false);
					};
					selfFn.xmlhttp.open("GET", url, true);
					selfFn.xmlhttp.send();
				};
				self.want = function(src, name, version) {
					if(typeof version === 'undefined')version = "LATEST";
					var obj = Object.create(null);
					obj.src = src;
					obj.name = name;
					obj.version = version;
					self.waitingQueue[name] = (obj);
					console.log("Waiting to load " + name + " from " + src);
					self.progress.progressMax = self.objLength(self.waitingQueue)+self.objLength(self.successQueue)+self.objLength(self.failureQueue);
					self.progress.progressLabel = "Loading Scripts...";
					//check if it exists in local storage
					self.getFromCache(name, src, true, true);
					return self;
				};
				self.progress = {};
				self.progress.labelQueue="";
				self.progress.progVal=0;
				self.progress.progMax=0;
				self.progress.progressObj=null;
				self.progress.__defineSetter__("progressLabel",function(val) {
					self.progress.labelQueue=val;
					self.progress.attemptLabelUpdate();
				});
				self.progress.__defineSetter__("progressValue", function(val) {
					self.progress.progVal=val;
					self.progress.attemptLabelUpdate();
				});
				self.progress.__defineSetter__("progressMax", function(val) {
					self.progress.progMax=val;
					self.progress.attemptLabelUpdate();
				});
				self.progress.__defineSetter__('progressHidden', function(val) {
					if(window['onLoadCalled']) {
						self.progress.attemptLabelUpdate();
						if(self.progress.progressObj!=null) {
							self.progress.progressObj.hidden=true;
						}else{
							window['hideProgressbar']=true;
						}
					}
				});
				self.progress.attemptLabelUpdate = function() {
					console.log('updating...');
					console.log([self,self.progress]);
					if(window['onLoadCalled']==true) {
						if(self.progress.progressObj==null) {
							self.progress.progressObj=new ProgressLoader(0,self.progress.progMax);
						}
						self.progress.progressObj.progress=self.progress.progVal;
						self.progress.progressObj.label=self.progress.labelQueue;
						self.progress.progressObj.max=self.progress.progMax;
					}
				};
				self.objLength = function(obj) {
					return Object.keys(obj).length;
				};
				return self;
			})();
			// ModuleController.
			//register scripts to load
			Loader.want("https://rawgit.com/mailmindlin/quantum-physics-sim/master/session.js",		"session.js",		"LATEST")
				.want("https://rawgit.com/mailmindlin/quantum-physics-sim/master/utils.js",		"utils.js",		"LATEST")
				.want("https://rawgit.com/mailmindlin/quantum-physics-sim/master/logger.js",		"logger.js",		"LATEST")
				.want("https://rawgit.com/mailmindlin/quantum-physics-sim/master/help.js",		"help.js",		"LATEST")
				// .want("https://rawgit.com/mailmindlin/quantum-physics-sim/master/networking.js",	"networking.js",	"LATEST")
				.want("https://rawgit.com/mailmindlin/quantum-physics-sim/master/renderer.js",		"renderer.js",		"LATEST")
				.want("https://rawgit.com/mailmindlin/quantum-physics-sim/master/renderUtils.js",	"renderUtils.js",	"LATEST")
				.want("https://rawgit.com/mailmindlin/quantum-physics-sim/master/input.js",		"input.js",		"LATEST")
				.want("webworkers.js",									"webworkers.js",	"LATEST")
				.want("https://rawgit.com/mailmindlin/quantum-physics-sim/master/jsmol.js",		"jsmol.js",		"LATEST")
				.want("https://rawgit.com/mailmindlin/quantum-physics-sim/engine/engine/numeric-1.2.6.min.js","numeric-1.2.6",	"LATEST")
				.want("https://rawgit.com/mailmindlin/quantum-physics-sim/engine/engine/quantumchem.js","quantumchem.js",	"LATEST")
				.want("https://rawgit.com/mailmindlin/quantum-physics-sim/engine/engine/rhf.js",	"rhf.js",		"LATEST")
				.want("https://rawgit.com/mailmindlin/quantum-physics-sim/engine/engine/sprintf.min.js","sprintf.js",		"LATEST")
				.want("https://rawgit.com/mailmindlin/quantum-physics-sim/engine/engine/sto1g.js"	,"sto1g.js",		"LATEST")
				.want("main.js",									"main.js",		"LATEST");


			var hasHadLoadError = false;//TODO: migrate functionality to Loader object
			function loadError(ev){
				if(hasHadLoadError)return;
				hasHadLoadError=true;
				console.log(ev);
				Loader.onFail("GITHUB",name);
				var reload = confirm("Sorry, but one or more of the scripts on this page failed to load ("+ev+").\nWould you like to reload?");
				if(reload)location.reload();
			}
		//]]></script>
		<!--[if lt IE 9]>
			<script src="//html5shiv.googlecode.com/svn/trunk/html5.js" class="imp-scr13></script>
		<![endif]-->
		<!--[if lt IE 8]>
			<link rel="stylesheet" href="../stylesheets/ie.css">
		<![endif]-->
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>

	</head>
	<body onload="load(false)">
		<div id="progressBar" style='position:fixed;top:0px;left:0px;margin:0px;padding:0px;background:rgb(53, 53, 53) url(http://mailmindlin.github.io/quantum-physics-sim/images/nav-bg.gif) repeat scroll 0% 0% / auto padding-box border-box;z-index:10001;height:100%;width:100%;opacity:0.9;'>
			<center style="top:calc(50% - 25px);width:100%;align:center;position:fixed;">
				<span style="height:30px;width:auto;">Hello! If the progressbar below doesn't do something withing a few minuites, please reload this page or something!</span>
			</center>
			<center style="top:calc(50% + 5px);width:100%;align:center;position:fixed;">
				<progress style="height:20px;"/>
			</center>
			<script type = "text/javascript">
				window['ProgressLoader'] = function(min,max) {
					var _domProgress= document.querySelector('#progressBar>center>progress');
					var _domLabel	= document.querySelector('#progressBar>center>span');
					var _offset,_max=0;
					var self = {};
					self.__defineGetter__("domProgress",function(){return _domProgress;});
					self.__defineGetter__("domLabel",function(){return _domLabel;});
					self.__defineGetter__("min",function(){return _offset;});
					self.__defineGetter__("max",function(){return _max;});
					self.__defineGetter__("size",function(){return self.max-self.min;});
					self.__defineGetter__("label",function(){return _domLabel.innerText;});
					self.__defineGetter__("progress",function(){return domProgress.getAttribute('value');});
					self.__defineSetter__("min",function(val){_offset=val;self.domProgress.setAttribute('max',self.max-self.min);});
					self.__defineSetter__("max",function(val){_max=val;self.domProgress.setAttribute('max',self.max-self.min);});
					self.__defineSetter__("label",function(val){self.domLabel.innerText=val;});
					self.__defineSetter__("progress",function(val){self.domProgress.setAttribute('value',val);});
					self.__defineSetter__("hidden",function(val){if(typeof val !== "boolean")throw(new Error("Property must be boolean!"));document.getElementById('progressBar').setAttribute('display',val?"none":"block");});
					//set props
					self.max=max;
					self.min=min;
					return self;
				};
			</script>
		</div>
		<div id="header">
			<nav>
				<li class="fork"><a href="https://github.com/mailmindlin/quantum-physics-sim">View On GitHub</a></li>
				<li class="downloads"><a href="../">Back to main page</a></li>
			</nav>
		</div><!-- end header -->

		<div class="wrapper">

			<section>
				<div id="title">
					<h1>Quantum Physics Simulator</h1>
					<p>Free online simulator</p>
					<hr>
					<span class="credits left">Project maintained by <a href="https://github.com/mailmindlin">mailmindlin</a></span>
					<span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></span>
				</div>
		
				<h3><a name="demo" class="anchor" href="#demo-main"><span class="octicon octicon-link"></span></a>Use, and be amazed.</h3>
		
				<div class="simulator-canvas"></div>
				<div id="input-test">If you are seeing this, something is wrong. (seriously)</div>
				<script type="text/javascript">
					//setup canvas as simulator
					//called on body load
					function load() {
						window['onLoadCalled']=true;
						if(window['hideProgressbar']==true)(new ProgressLoader(0,0)).hidden=true;
						if(Loader.successQueue.length > 0) {window.setTimeout(this, 20); return;}
						var canvas = $('.simulator-canvas')[0];
						var input = $('#input-test')[0];
						window['inp']=new Input({name:'input-test1', dom:input});
						//setup jsmol
						JSmolInterface.info.j2s="http://mailmindlin.github.io/quantum-physics-sim/jsmol/jsmol/j2s";
						JSmolInterface.start($('.simulator-canvas')[0]);
						//TODO finish
					}
				</script>
				<br/>
				
				<h3><a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>How to use</h3>
				<p>
					<!--
					To use this is pretty easy.
					<br/>
					Just type in the chemical symbol for the atom in the 'element' colunm, and type in the cartesian coordinates to the x y and z fields (scientific notation & decimals supported).
					To add anoter atom, push <code>tab</code> on the last textbox on the last row. If a box turns red, hover over it to find out the problem.
					The data is updated realtime (ish).
					-->
					Good question. As of the time of this being written, it wasn't functional at all (makes these instructions hard to write)! If the simulator is functional
					or semi-functional when you read this, then please submit an issue <a href="https://github.com/mailmindlin/quantum-physics-sim/issues/new">here</a>, so I remember.
				</p>
				<h3><a name="faq" class="anchor" href="#faq"><span class="octicon octicon-link"></span></a>FAQ</h3>
				<p>
					<ul>
						<li>
							<a href="#usage>$" name="usage>$" class="anchor"><span class="octicon octicon-link"></span></a>
							<!-- add something here -->
						</li>
					</ul>
				</p>
				
			</section>
		</div>
		<div id="help-div"></div>
		<center id="btm-arrow">&#8978;</center>
		<center id="footer-wrapper">
			<!--<table border="0px"><tr><td><button>Show/Hide console</button><!--</td></tr></table>-->
		</center>
		<!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
	</body>
</html>

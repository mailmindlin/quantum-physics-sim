<!doctype html>
<html>
	<head>
		<meta charset="utf-8"/>
		<meta http-equiv="X-UA-Compatible" content="chrome=1"/>
		<title>Quantum Physics Simulator by mailmindlin</title>
		<!--Meta tags -->
		<meta name="description" content="A simulator for the quantum properties of theoretical molecules."/>
		<meta name="robots" content="INDEX, noimageindex"/><!--no image index is just for copyright stuff-->
		<meta name="revisit-after" content="2 days"/><!--because of constant updates-->
		<meta name="author" content="mailmindlin, jschrier"/>
		<!-- github's css -->
		<link rel="stylesheet" href="../stylesheets/styles.css" onerror="loadError('Github\'s styles.css')"/>
		<link rel="stylesheet" href="../stylesheets/pygment_trac.css" onerror="loadError('Github\'s pygment_trac.css')"/>
		<!-- my css -->
		<link rel="stylesheet" href="main.css" onerror="loadError('main.css')"/>
		<link rel="stylesheet" href="animations.css" onerror="loadError('animations.css')"/>
		<link rel="stylesheet" href="cursor-props.css" onerror="loadError('cursor-props.css')"/>
		<!-- jquery -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" class="imp-scr1" onerror="loadError('jquery 1.7.1')"></script>
		<script src="../javascripts/respond.js" class="imp-scr2" onerror="loadError('Github\'s respond.js')"></script>
		<!-- JSMol -->
		<script type="text/javascript" src="../jsmol/jsmol/JSmol.min.js" onerror="loadError('JSmol.js')"></script>
		<!-- my scripts -->
		<script type="text/javascript" onerror="loadError('Main loader')">//<![CDATA[
			//cross-compatibility
			//indexedDB stuff
			window.indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;
			window.IDBTransaction = window.IDBTransaction || window.webkitIDBTransaction || window.msIDBTransaction;
			window.IDBKeyRange = window.IDBKeyRange || window.webkitIDBKeyRange || window.msIDBKeyRange;
			
			//set whether this is a production build. Production builds have some features enabled/disabled
			window['Production'] = true;
			
			//setup std. objects
			window.debug=false;
			window.isWebkit = 'WebkitAppearance' in document.documentElement.style;
			window['Field'] = function(name, unique) {
				var self = Object.create(null);
				Object.defineProperty(self,"name",{value:name,enumerable:true,writable:true});
				Object.defineProperty(self,"unique",{value:unique,enumerable:true,writable:true});
				return self;
			};
			window['Table'] = function(name, fields, keypath) {
				var self = Object.create(null);
				//vardef
				Object.defineProperty(self, "name", {value: name, writable: true,enumerable: true});
				Object.defineProperty(self, "fields", {value: ((fields === undefined)?[]:fields),writable:true,enumerable:true});
				Object.defineProperty(self, "keyPath", {value: keypath, writable: true, enumerable: true,configurable:true});
				self.addField = function(field) {
					self.fields.push(field);
					return self;//allow for chaining
				};
				return self;
			};
			/**
			 * DB interface object. Acts as a buffer between the database and JS code
			 */
			 window['DBInterface'] = function(args) {
			 	//safety check
			 	if(typeof args === 'undefined') args = {};

			 	//define self
			 	var self = Object.create(null);

			 	//vardef
			 	self.dbName 	= (args.dbName !== undefined)?args.dbName:"Generic Database";
			 	self.dbVersion 	= (typeof args.version === 'number')?args.version:0;
			 	self.tables	= (typeof args.tables === "object")?args.tables:[];
			 	Object.defineProperty(self,	"openRequest",	{value:null,writable:true});
			 	Object.defineProperty(self,	"state",	{value:-1,writable:true,enumerable:true});
			 	Object.defineProperty(self,	"storeBuffer",	{value:[],writable:true,enumerable:true});
			 	Object.defineProperty(self,	"db",		{value:null,writable:true,enumerable:true});

			 	//functiondef
			 	self.setup = function() {
			 		console.log("Initializing database "+self.dbName + "...");
			 		self.state = 0;
			 		self.openRequest = window.indexedDB.open(self.dbName, self.dbVersion);
			 		self.openRequest.onerror = self.onerror;
			 		self.openRequest.onsuccess = self.onsuccess;
			 		self.openRequest.onupgradeneeded = self.onupgradeneeded;
			 		console.log("\t%cDone.",'color:green;');
			 	};
			 	self.onerror = function(error) {
			 		if(self.state==0){
			 			console.error([new Error("DB creation failed"),error]);
			 			return;
			 		}
			 		//generic mesage
			 		console.error([new Error("An error occured!" + (typeof error !== 'undefined')?("\n"+error.message):""),error]);
			 	};
			 	self.onsuccess = function(event) {
			 		console.log(["IndexedDB opening Success!",event]);
			 		if (self.state == 0 && self.openRequest == "done") {
			 			console.log("The db is open!");
			 			self.db = event.result;
			 			self.state = 1;
			 		}
			 	};
			 	self.onupgradeneeded = function(event) {
			 		console.log("Upgrading database...");
			 		self.db = event.target.result;
			 		//create tables
			 		for (var i = 0; i < self.tables.length; ++i) {
			 			console.log("\tCreating table '"+self.tables[i].name+"' ("+(i+1)+"/"+self.tables.length+")...");
			 			var table = self.tables[i];
			 			var kpArgs={keyPath: (typeof table.keyPath === 'string')?table.keyPath:"ssn"};
			 			if(debug)console.log(kpArgs);
			 			table.target = self.db.createObjectStore(table.name, kpArgs);
			 			//create fields
			 			for(var i=0;i<table.fields.length;++i){
			 				console.log("\t\tCreating field '"+table.fields[i].name+"' ("+(i+1)+"/"+table.fields.length+")...");
			 				var field = table.fields[i];
			 				var indexArgs = (((typeof field.args==='object') && (typeof field.args.unique !== 'undefined'))?field.args:{unique: false});
			 				if(debug)console.log(indexArgs);
			 				table.target.createIndex(field.name, field.name, indexArgs);
			 				table.fields[i]=field;
			 				console.log("\t\t\t%cDone.",'color:green;');
			 			}
			 			//call any internal handler
			 			if(typeof table.onCreate === 'function')table.onCreate();
			 			self.tables[i]=table;
			 		}
			 		console.log("\t%cDone.",'color:green;');
			 	};
			 	self.delete = function() {
			 		console.log("Deleting database '"+self.dbName+"'...");
			 		indexedDB.deleteDatabase(self.dbName);
			 		self.state=-1;
			 		console.log("\t%cDone.",'color:green;');
			 	};
			 	self.getDB = function() {
			 		return self.openRequest.result;
			 	};
			 	self.getTable = function(name) {
			 		var obj = Object.create(null);
			 		obj.db = self.getDB();
			 		obj.transaction = obj.db.transaction([name], "readwrite");
			 		obj.objectStore = transaction.objectStore(name);
			 		return obj;
			 	};
			 	self.get = function(callback) {

			 	};
			 	self.put = function(callback) {

			 	}
			 	//setup object
			 	if((typeof args.waitForSetup==='undefined')||(!args.waitForSetup))self.setup();
			 	return self;
			 };
			 window['Module'] = function(name, script, dependencies, funcName) {
			 	var module		= Object.create(null);
			 	module.name		= name;
			 	module.script		= script;
			 	module.dependencies	= dependencies;
			 	module.funcName		= funcName;
			 	module.isComplete	= false;
			 	module.run = function() {
			 		window[funcName]();
			 		isComplete=true;
			 		window['ModuleController'].onModuleCompletion();
			 	};
			 	return module;
			 };
			 window['ModuleController'] = (function() {
			 	var self = Object.create(null);
			 	self.canStart = false;
			 	self.modules = [];
			 	self.availableModules = [];
			 	self.registerModule = function(module) {
			 		self.modules.push(module);
			 	};
			 	self.onScriptLoad = function(scriptName) {
			 		for(var i=0;i<modules.length;++i) {
			 			var cModule = modules[i];
			 			if(cModule.script = scriptName) {
			 				//check validity
			 				var requisites = cModule.dependencies;
			 				for(var i=0;i<requisites.length;++i){
			 					var tModule = self.getScript(requisite[i]);
			 					if(tModule.isComplete)requisites.splice(i,1);//remove from array
			 				}
			 				if(requisites.length==0)cModule.run();
			 			}
			 		}
			 	};
			 	self.getScript = function(name) {
			 		for(var i = 0; i<modules.length;++i) {
			 			if(modules[i].name == name)return modules[i];
			 		}
			 	};
			 	self.start = function() {
			 		self.canStart = true;
			 		for(var module in self.availableModules) {
			 			window.setTimeout(module.run(),0);//run module asynchronously
			 		};
			 	};
			 })();
			 window['TSStorage'] = function(args) {
			 	var self = Object.create(null);
			 	self.put = function(name, url, data) {
			 		var scrObj = Object.create(null);
			 		scrObj.name	= name;
			 		scrObj.url	= url;
			 		// scrObj.version	= version;
			 		scrObj.data	= data;
			 		window.localStorage.setItem("SCRIPTSTORE-" + name, JSON.stringify(scrObj));
			 	};
			 	self.has = function(name) {
			 		return (window.localStorage.getItem("SCRIPTSTORE-" + name) !== null);
			 	};
			 	self.get = function(name, version) {
			 		return JSON.parse(window.localStorage.getItem("SCRIPTSTORE-" + name)).data;
			 	};
			 	self.setup = function() {
			 		return self;
			 	};
			 	return self.setup();
			 };
			/**
			 * Loader object.
			 * Basically handles scripts that load or fail to load, and smooths it out.
			 */
			window['Loader'] = (function() {
				var self = Object.create(null);
				//vardef
				self.hasErrors=false;
				self.failureQueue = {};
				self.successQueue = {};
				self.waitingQueue = {};
				self.tsStorage    = new TSStorage();
				self.db		  = new DBInterface({
					dbName: "ScriptDB",
					version: 1,
					tables: [{name: "Files",
						keyPath:"Name",
						fields: [{name:"Name", args:{unique: true}},
							{name:"Version", args:{unique: false}},
							{name:"Data",args:{unique: false}}]}]
					});
				//functiondef
				self.onSuccess = function(src, name) {
					var obj = Object.create(null);
					obj.src = src;
					obj.name = name;
					self.successQueue[name] = obj;
					delete self.waitingQueue[name];
					delete self.waitingQueue[name];
					console.log("%cLoaded " + name + " from " + src,'color:green;');
				};
				self.onFail = function(src, name) {
					self.hasErrors=true;
					var obj = Object.create(null);
					obj.src = src;
					obj.name = name;
					self.failureQueue = obj;
					if((typeof self.waitingQueue[name] !== 'undefined')/* && (self.waitingQueue[name].cachable)*/)self.createScript(name, self.getFromCache(name, self.waitingQueue[name].url,0,true));
					delete self.waitingQueue[name];
					//TODO remove object from the waitingQueue
					console.log("%cFailed to load " + name + " from " + src,'color:red;');
				};
				self.createScript = function(name, data) {
					var sct = document.createElement("script");
					sct.setAttribute("name",name);
					sct.innerHTML=data;
					sct.setAttribute("type","text/javascript");
					var headTag = document.querySelector("head");
					headTag.appendChild(sct);
				};
				self.getFromCache = function(name, url, tryAJAX, canCreateScript, tryTSS) {
					if(typeof tryAJAX === 'undefined')tryAJAX=true;
					if (typeof version === "undefined")version = "LATEST";
					if(typeof tryTSS === 'undefined')tryTSS=true;
					if(typeof canCreateScript === 'undefined')canCreateScript=false;
					if(self.tsStorage.has(name) && (window['Production'] == true) && canCreateScript && tryTSS) {//only read from cache if it's production, TSS is allowed (TSStorage), and it can create a script (because why load it from the cache if it cant do anything with it).
						if(canCreateScript)self.createScript(name, self.tsStorage.get(name));
					} else if (tryAJAX) {
						console.log("Getting " + name + " from " + url + " via AJAX");
						self.getFromAjax(name, url, false, function(response, wasGood) {
							if(!wasGood) {
								console.error("AJAX to " + name + "Failed!");
								return;
							}
							self.tsStorage.put(name, url, response.target.responseText);
							if(canCreateScript)self.createScript(name, response.target.responseText);
						});
					}
					//TODO: get db to work
					/*self.db.get("Files", name, function(dbOut){
						console.log(dbOut);
						if(typeof dbOut !== 'undefined') {
							var element = document.createElement('script');
							element.setAttribut('type','text/javascript');
							element.innerText=dbOut.data;
							document.getElementsByTagName("head")[0].appendChild(fileref);
						}else{
							//do ajax
						}
					});*/
				};
				self.getFromAjax = function(name, url, directlyAdd, callback) {//callback is optional
					var selfFn = Object.create(null);
					selfFn.name = name;
					selfFn.url = url;
					selfFn.directlyAdd = directlyAdd;
					if (window.XMLHttpRequest) {
						selfFn.xmlhttp=new XMLHttpRequest();// code for IE7+, Firefox, Chrome, Opera, Safari
					} else {
						selfFn.xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");// code for IE6, IE5
					}
					if(selfFn.xmlhttp == null) throw(new Error("XMLHTTP not supported!"));
					selfFn.xmlhttp.onload = function(ev) {
						self.tsStorage.put(selfFn.name, selfFn.url, selfFn.xmlhttp.responseText);
						console.log(["XMLHTTP Success",selfFn,ev]);
						if(typeof callback === 'function')callback(ev, true);
					};
					selfFn.xmlhttp.onerror = function(e) {
						console.log(e);
						console.log(["XMLHTTP Failure",selfFn,e]);
						callback(ev, false);
					};
					selfFn.xmlhttp.open("GET", url, true);
					selfFn.xmlhttp.send();
				};
				self.want = function(src, name, version) {
					if(typeof version === 'undefined')version = "LATEST";
					var obj = Object.create(null);
					obj.src = src;
					obj.name = name;
					obj.version = version;
					self.waitingQueue[name] = (obj);
					console.log("Waiting to load " + name + " from " + src);
					//check if it exists in local storage
					self.getFromCache(name, src, true, true);
					return self;
				};
				return self;
			})();
			//register scripts to load
			Loader.want("https://rawgit.com/mailmindlin/quantum-physics-sim/master/session.js",		"session.js",		"LATEST")
				.want("https://rawgit.com/mailmindlin/quantum-physics-sim/master/utils.js",		"utils.js",		"LATEST")
				.want("https://rawgit.com/mailmindlin/quantum-physics-sim/master/logger.js",		"logger.js",		"LATEST")
				.want("https://rawgit.com/mailmindlin/quantum-physics-sim/master/help.js",		"help.js",		"LATEST")
				// .want("https://rawgit.com/mailmindlin/quantum-physics-sim/master/networking.js",	"networking.js",	"LATEST")
				.want("https://rawgit.com/mailmindlin/quantum-physics-sim/master/renderer.js",		"renderer.js",		"LATEST")
				.want("https://rawgit.com/mailmindlin/quantum-physics-sim/master/renderUtils.js",	"renderUtils.js",	"LATEST")
				.want("https://rawgit.com/mailmindlin/quantum-physics-sim/master/input.js",		"input.js",		"LATEST")
				.want("webworkers.js",									"webworkers.js",	"LATEST")
				.want("https://rawgit.com/mailmindlin/quantum-physics-sim/master/jsmol.js",		"jsmol.js",		"LATEST")
				.want("main.min.js",									"main.js",		"LATEST");


			var hasHadLoadError = false;//TODO: migrate functionality to Loader object
			function loadError(ev){
				if(hasHadLoadError)return;
				hasHadLoadError=true;
				console.log(ev);
				Loader.onFail("GITHUB",name);
				var reload = confirm("Sorry, but one or more of the scripts on this page failed to load ("+ev+").\nWould you like to reload?");
				if(reload)location.reload();
			}
		//]]></script>
		<!-- <script type="text/javascript" src="https://rawgit.com/mailmindlin/quantum-physics-sim/master/session.js" onerror="loadError('session.js')" onload="Loader.onSuccess('https://rawgit.com/mailmindlin/quantum-physics-sim/master/session.js','session.js')"></script>
		<script type="text/javascript" src="https://rawgit.com/mailmindlin/quantum-physics-sim/master/utils.js" onerror="loadError('utils.js')" onload="Loader.onSuccess('https://rawgit.com/mailmindlin/quantum-physics-sim/master/utils.js','utils.js')"></script>
		<script type="text/javascript" src="https://rawgit.com/mailmindlin/quantum-physics-sim/master/logger.js" onerror="loadError('logger.js')" onload="Loader.onSuccess('https://rawgit.com/mailmindlin/quantum-physics-sim/master/logger.js','logger.js')"></script>
		<script type="text/javascript" src="https://rawgit.com/mailmindlin/quantum-physics-sim/master/help.js" onerror="loadError('help.js')" onload="Loader.onSuccess('https://rawgit.com/mailmindlin/quantum-physics-sim/master/help.js','help.js')"></script>
		<script type="text/javascript" src="https://rawgit.com/mailmindlin/quantum-physics-sim/master/networking.js" onerror="loadError('networking.js')" onload="Loader.onSuccess('https://rawgit.com/mailmindlin/quantum-physics-sim/master/networking.js','networking.js')"></script>
		<script type="text/javascript" src="https://rawgit.com/mailmindlin/quantum-physics-sim/master/renderer.js" onerror="loadError('renderer.js')" onload="Loader.onSuccess('https://rawgit.com/mailmindlin/quantum-physics-sim/master/renderer.js','renderer.js')"></script>
		<script type="text/javascript" src="https://rawgit.com/mailmindlin/quantum-physics-sim/master/renderUtils.js" onerror="loadError('renderUtils.js')" onload="Loader.onSuccess('https://rawgit.com/mailmindlin/quantum-physics-sim/master/renderUtils.js','renderUtils.js')"></script>
		<script type="text/javascript" src="https://rawgit.com/mailmindlin/quantum-physics-sim/master/input.js" onerror="loadError('input.js')" onload="Loader.onSuccess('https://rawgit.com/mailmindlin/quantum-physics-sim/master/input.js','input.js')"></script>
		<script type="text/javascript" src="https://rawgit.com/mailmindlin/quantum-physics-sim/master/jsmol.js" onerror="loadError('jsmol.js')" onload="Loader.onSuccess('https://rawgit.com/mailmindlin/quantum-physics-sim/master/jsmol.js','jsmol.js')"></script>
		<script type="text/javascript" src="webworkers.js" onerror="loadError('webworkers.js')" onload="Loader.onSuccess('webworkers.js','webworkers.js')"></script>
		<script type="text/javascript" src="main.js" onerror="loadError('main.js')"></script>-->
		<!--<script type="text/javascript" src="main.min.js"></script>-->
		<!--[if lt IE 9]>
			<script src="//html5shiv.googlecode.com/svn/trunk/html5.js" class="imp-scr13></script>
		<![endif]-->
		<!--[if lt IE 8]>
			<link rel="stylesheet" href="../stylesheets/ie.css">
		<![endif]-->
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>

	</head>
	<body onload="load()">
		<div id="header">
			<nav>
				<li class="fork"><a href="https://github.com/mailmindlin/quantum-physics-sim">View On GitHub</a></li>
				<li class="downloads"><a href="../">Back to main page</a></li>
			</nav>
		</div><!-- end header -->

		<div class="wrapper">

			<section>
				<div id="title">
					<h1>Quantum Physics Simulator</h1>
					<p>Free online simulator</p>
					<hr>
					<span class="credits left">Project maintained by <a href="https://github.com/mailmindlin">mailmindlin</a></span>
					<span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></span>
				</div>
		
				<h3><a name="demo" class="anchor" href="#demo-main"><span class="octicon octicon-link"></span></a>Use, and be amazed.</h3>
		
				<div class="simulator-canvas"></div>
				<div id="input-test">If you are seeing this, something is wrong. (seriously)</div>
				<script type="text/javascript">
					//setup canvas as simulator
					//called on body load
					function load() {
						var canvas = $('.simulator-canvas')[0];
						var input = $('#input-test')[0];
						window['inp']=new Input({name:'input-test1', dom:input});
						//TODO finish
					}
				</script>
				<br/>
				
				<h3><a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>How to use</h3>
				<p>
					<!--
					To use this is pretty easy.
					<br/>
					Just type in the chemical symbol for the atom in the 'element' colunm, and type in the cartesian coordinates to the x y and z fields (scientific notation & decimals supported).
					To add anoter atom, push <code>tab</code> on the last textbox on the last row. If a box turns red, hover over it to find out the problem.
					The data is updated realtime (ish).
					-->
					Good question. As of the time of this being written, it wasn't functional at all (makes these instructions hard to write)! If the simulator is functional
					or semi-functional when you read this, then please submit an issue <a href="https://github.com/mailmindlin/quantum-physics-sim/issues/new">here</a>, so I remember.
				</p>
				<h3><a name="faq" class="anchor" href="#faq"><span class="octicon octicon-link"></span></a>FAQ</h3>
				<p>
					<ul>
						<li>
							<a href="#usage>$" name="usage>$" class="anchor"><span class="octicon octicon-link"></span></a>
							<!-- add something here -->
						</li>
					</ul>
				</p>
				
			</section>
		</div>
		<div id="help-div"></div>
		<center id="btm-arrow">&#8978;</center>
		<center id="footer-wrapper">
			<!--<table border="0px"><tr><td><button>Show/Hide console</button><!--</td></tr></table>-->
		</center>
		<!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
	</body>
</html>
